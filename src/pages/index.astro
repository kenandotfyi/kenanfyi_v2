---
import { getCollection } from "astro:content";
import Baz from "../layouts/Baz.astro";
import { Icon } from "astro-icon/components";

const pageTitle = "index";

const allThoughts = await getCollection(
    "thoughts",
    ({ data }) => data.draft !== true,
);
allThoughts.sort((a: any, b: any) => b.data.published - a.data.published);

const allBits = await getCollection("bits", ({ data }) => data.draft !== true);
allBits.sort((a: any, b: any) => b.data.published - a.data.published);

const RDAPIKEY = import.meta.env.RDAPIKEY;
const collectionId = import.meta.env.RDCOLLECTIONID;

// get the latest 10 raindrop links
var bearer = "Bearer " + RDAPIKEY;
var rdUrl = `https://api.raindrop.io/rest/v1/raindrops/${collectionId}?perpage=10`;

async function fetchLinks() {
    const resp = await fetch(rdUrl, {
        method: "GET",
        credentials: "include",
        headers: {
            Authorization: bearer,
            "Content-Type": "application/json",
        },
    });
    const data = await resp.json();
    return data;
}

interface RaindropItem {
    link: string;
    title: string;
    note: string;
    excerpt: string;
    created: string;
}

const links = await fetchLinks();
---

<Baz pageTitle={pageTitle} wide>
    <div class="home">
        <div class="hero">
            <video class="hero-video" autoplay muted playsinline loop>
                <source src="/hero-2.webm" type="video/webm" />
            </video>
        </div>

        <div class="intro-header">
            <h1 class="hero-name">Kenan Akinci</h1>
            <p class="role">Sr. Hardware Design Engineer</p>
        </div>

        <div class="intro-row">
            <div class="intro-col">
                <p>
                    I'm a senior hardware design engineer from Germany with over
                    10 years of experience in designing and developing hardware
                    for power electronics systems. Although not officially a
                    software engineer, I program in various languages for
                    personal and professional projects too.
                </p>
                <p></p>
            </div>
            <div class="intro-col">
                <p>
                    I build power electronics systems by day and tinker with
                    code, words, and the web by night. This site is my little
                    corner of the internet with just things I find worth writing
                    down. I believe everyone should have their own place on the
                    web. Although I write mostly for myself, you may find it
                    interesting too. <a href="/about/">More about me →</a>
                </p>
                <div class="social-icons">
                    <a
                        href="https://github.com/kenandotfyi"
                        target="_blank"
                        rel="noopener"
                        aria-label="GitHub"
                    >
                        <Icon name="ph:github-logo-duotone" size="22" />
                    </a>
                    <a
                        href="https://mas.to/@ingenieur"
                        target="_blank"
                        rel="noopener"
                        aria-label="Mastodon"
                    >
                        <Icon name="ph:mastodon-logo-duotone" size="22" />
                    </a>
                    <a
                        href="https://www.linkedin.com/in/kenanakinci/"
                        target="_blank"
                        rel="noopener"
                        aria-label="LinkedIn"
                    >
                        <Icon name="ph:linkedin-logo-duotone" size="22" />
                    </a>
                    <a href="mailto:hey@kenan.fyi" aria-label="Email">
                        <Icon name="ph:envelope-duotone" size="22" />
                    </a>
                    <a href="/rss.xml" aria-label="RSS Feed">
                        <Icon name="ph:rss-duotone" size="22" />
                    </a>
                </div>
            </div>
        </div>

        <div class="grid">
            <section class="col">
                <h2 class="section-heading">Thoughts</h2>
                <div class="posts-list">
                    {
                        allThoughts.map((post) => (
                            <article class="post-item">
                                <a
                                    href={`/thoughts/${post.id}`}
                                    class="post-title"
                                >
                                    <Icon name="ph:feather-duotone" size="16" />
                                    <span>{post.data.title}</span>
                                </a>
                            </article>
                        ))
                    }
                </div>
            </section>

            <section class="col">
                <h2 class="section-heading">Bits</h2>
                <div class="posts-list">
                    {
                        allBits.map((post) => (
                            <article class="post-item">
                                <a href={`/bits/${post.id}`} class="post-title">
                                    <Icon name="ph:asterisk-fill" size="16" />
                                    <span>{post.data.title}</span>
                                </a>
                            </article>
                        ))
                    }
                </div>
            </section>

            <section class="col col-bookmarks">
                <h2 class="section-heading">Bookmarks</h2>
                <div class="posts-list">
                    {
                        links.items.map((item: RaindropItem) => (
                            <article class="post-item">
                                <a
                                    href={item.link}
                                    target="_blank"
                                    class="post-title"
                                >
                                    <Icon
                                        name="ph:bookmark-duotone"
                                        size="16"
                                    />
                                    <span>{item.title}</span>
                                </a>
                            </article>
                        ))
                    }
                    <p class="see-more"><a href="/bookmarks">see more →</a></p>
                </div>
            </section>
        </div>
    </div>
</Baz>

<style>
    .home {
        color: var(--fg-bright);
        font-size: var(--text-base);
    }

    /* ── Hero ── */
    .hero {
        height: 480px;
        margin-left: calc(50% - 50vw);
        margin-right: calc(50% - 50vw);
        overflow: hidden;
        margin-bottom: 0;
    }

    .hero-video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .intro-header {
        padding: calc(var(--q) * 8) 0 calc(var(--q) * 4);
    }

    .hero-name {
        font-size: clamp(1.5rem, 3vw, 2.5rem);
        font-weight: 400;
        color: var(--red);
        margin: 0 0 calc(var(--q) * 2);
        line-height: 1.1;
    }

    .role {
        font-family: var(--font-mono);
        font-size: clamp(0.75rem, 1.5vw, 1rem);
        color: var(--fg-muted);
        margin: 0;
        letter-spacing: 0.05em;
    }

    .intro-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: calc(var(--q) * 12);
        padding-bottom: calc(var(--q) * 10);
        margin-bottom: calc(var(--q) * 8);
    }

    .intro-row::after {
        content: "";
        display: block;
        grid-column: 1 / -1;
        border-bottom: 1px solid var(--border-subtle);
        margin-left: calc(50% - 50vw);
        margin-right: calc(50% - 50vw);
    }

    .intro-col {
        display: flex;
        flex-direction: column;
        gap: calc(var(--q) * 3);
        color: var(--fg-primary);
        font-size: var(--text-base);
        line-height: 1.7;
    }

    .intro-col p {
        margin: 0;
    }

    .social-icons {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: calc(var(--q) * 5);
        margin-top: auto;
        padding-top: calc(var(--q) * 4);
    }

    .social-icons a {
        color: var(--fg-muted);
        text-decoration: none;
        line-height: 0;
        transition: color 0.2s ease;
    }

    .social-icons a:hover {
        color: var(--accent);
        background: none;
    }

    /* ── 3-col grid ── */
    .grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: calc(var(--q) * 8);
        margin-bottom: calc(var(--q) * 16);
    }

    .section-heading {
        font-family: var(--font-mono);
        font-size: var(--text-base);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--accent);
        margin-top: 0;
        margin-bottom: calc(var(--q) * 4);
    }

    .posts-list {
        display: flex;
        flex-direction: column;
        gap: calc(var(--q) * 1);
    }

    .post-title {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: var(--text-base);
        line-height: 1.4;
        padding: calc(var(--q) * 1) 0;
        text-decoration: none;
    }

    .post-title span {
        text-decoration: underline;
        text-decoration-style: dotted;
        text-decoration-color: var(--red);
        text-decoration-thickness: 2px;
        text-underline-offset: 3px;
    }

    .col-bookmarks .post-title {
        color: var(--fg-muted);
    }

    .post-title :global(svg) {
        opacity: 0.4;
        flex-shrink: 0;
    }

    .see-more {
        margin-top: calc(var(--q) * 3);
        text-align: right;
    }

    /* ── Responsive ── */
    @media (max-width: 900px) {
        .grid {
            grid-template-columns: 1fr 1fr;
        }
        .col:last-child {
            grid-column: 1 / -1;
        }
    }

    @media (max-width: 600px) {
        .hero {
            height: 300px;
        }
        .intro-row {
            grid-template-columns: 1fr;
            gap: calc(var(--q) * 4);
        }
        .grid {
            grid-template-columns: 1fr;
        }
        .col:last-child {
            grid-column: auto;
        }
    }
</style>
