---
const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
    if (href === "/") {
        return currentPath === "/";
    }
    return currentPath.startsWith(href);
};
---

<nav class="top-nav">
    <a href="/" class="site-name"
        ><img src="/logo.svg" width="48" height="48" alt="kenan.fyi" /></a
    >
    <div class="nav-right">
        <div class="nav-links">
            <a
                href="/thoughts/"
                class:list={["nav-link", { active: isActive("/thoughts/") }]}
            >
                Thoughts
            </a>
            <a
                href="/electronics/"
                class:list={["nav-link", { active: isActive("/electronics/") }]}
            >
                Electronics
            </a>
            <a
                href="/bits/"
                class:list={["nav-link", { active: isActive("/bits/") }]}
            >
                Bits
            </a>
            <a
                href="/library/"
                class:list={["nav-link", { active: isActive("/library/") }]}
            >
                Library
            </a>
            <a
                href="/blogroll/"
                class:list={["nav-link", { active: isActive("/blogroll/") }]}
            >
                Blogroll
            </a>
            <a
                href="/about/"
                class:list={["nav-link", { active: isActive("/about/") }]}
            >
                About
            </a>
        </div>
        <button
            id="panels-toggle"
            class="panels-toggle"
            aria-label="Toggle Panels"
        >
            Panels
        </button>
    </div>
</nav>

<script>
    const PANELS_STORAGE_KEY = "panels-enabled";
    const panelsToggle = document.getElementById("panels-toggle");

    function getPanelsEnabled() {
        const stored = localStorage.getItem(PANELS_STORAGE_KEY);
        return stored !== "false";
    }

    function updatePanelsToggle() {
        const isEnabled = getPanelsEnabled();
        if (panelsToggle) {
            panelsToggle.classList.toggle("disabled", !isEnabled);
        }
        window.dispatchEvent(
            new CustomEvent("panels-toggle", {
                detail: { enabled: isEnabled },
            }),
        );
    }

    panelsToggle?.addEventListener("click", (e) => {
        e.preventDefault();
        const currentState = getPanelsEnabled();
        localStorage.setItem(PANELS_STORAGE_KEY, (!currentState).toString());
        updatePanelsToggle();
    });

    updatePanelsToggle();
</script>

<style>
    .top-nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1500;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 24px;
        background: transparent;
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(12px);
    }

    .site-name {
        display: block;
        line-height: 0;
        text-decoration: none;
    }

    .site-name:hover {
        background: none;
    }

    .site-name img {
        display: block;
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-links {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .nav-link {
        padding: 4px 10px;
        text-decoration: none;
        color: var(--text-muted);
        font-size: 1rem;
        border-radius: var(--border-s);
        transition: color 0.2s ease;
    }

    .nav-link:hover {
        color: var(--accent);
    }

    .nav-link.active {
        color: var(--accent);
        font-weight: 600;
    }

    .panels-toggle {
        padding: 4px 10px;
        background: none;
        border: 1px solid var(--panel-border);
        color: var(--text-muted);
        border-radius: var(--border-s);
        cursor: pointer;
        font-size: 0.85rem;
        font-family: inherit;
        transition: all 0.2s ease;
    }

    .panels-toggle:hover {
        border-color: var(--accent);
        color: var(--accent);
    }

    .panels-toggle.disabled {
        opacity: 0.4;
        text-decoration: line-through;
    }

    @media (max-width: 1100px) {
        .panels-toggle {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .top-nav {
            flex-direction: column;
            gap: 8px;
            padding: 10px 16px;
        }

        .nav-links {
            flex-wrap: wrap;
            justify-content: center;
            gap: 2px;
        }

        .nav-link {
            font-size: 0.85rem;
            padding: 4px 8px;
        }
    }
</style>
