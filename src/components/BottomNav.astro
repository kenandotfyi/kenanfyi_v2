---
import { Icon } from "astro-icon/components";

const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
    if (href === "/") {
        return currentPath === "/";
    }
    return currentPath.startsWith(href);
};
---

<nav class="bottom-nav">
    <div class="nav-links">
        <a
            href="/thoughts/"
            class:list={["nav-link", { active: isActive("/thoughts/") }]}
            title="Thoughts"
        >
            Thoughts
        </a>
        <a
            href="/electronics/"
            class:list={["nav-link", { active: isActive("/electronics/") }]}
            title="Electronics"
        >
            Electronics
        </a>
        <a
            href="/bits/"
            class:list={["nav-link", { active: isActive("/bits/") }]}
            title="Bits"
        >
            Bits
        </a>
        <a
            href="/library/"
            class:list={["nav-link", { active: isActive("/library/") }]}
            title="Library"
        >
            Library
        </a>
        <a
            href="/blogroll/"
            class:list={["nav-link", { active: isActive("/blogroll/") }]}
            title="Blogroll"
        >
            Blogroll
        </a>
    </div>

    <a href="/" class="logo-link">
        <img src="/logo.svg" width="64" height="64" alt="" />
    </a>
    <button
        id="panels-toggle"
        class="panels-toggle function-button"
        aria-label="Toggle Panels"
    >
        Panels
    </button>
</nav>

<script>
    const PANELS_STORAGE_KEY = "panels-enabled";
    const panelsToggle = document.getElementById("panels-toggle");

    function getPanelsEnabled() {
        const stored = localStorage.getItem(PANELS_STORAGE_KEY);
        return stored !== "false";
    }

    function updatePanelsToggle() {
        const isEnabled = getPanelsEnabled();
        if (panelsToggle) {
            panelsToggle.classList.toggle("disabled", !isEnabled);
        }
        window.dispatchEvent(
            new CustomEvent("panels-toggle", {
                detail: { enabled: isEnabled },
            }),
        );
    }

    panelsToggle?.addEventListener("click", (e) => {
        e.preventDefault();
        const currentState = getPanelsEnabled();
        localStorage.setItem(PANELS_STORAGE_KEY, (!currentState).toString());
        updatePanelsToggle();
    });

    updatePanelsToggle();
</script>

<style>
    .bottom-nav {
        position: fixed;
        bottom: 24px;
        left: 24px;
        z-index: 1500;
        display: flex;
        flex-direction: column;
        align-items: start;
        gap: 4px;
    }

    .nav-links {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .logo-link {
        display: block;
        line-height: 0;
        text-decoration: none;
    }

    .logo-link:hover {
        background: transparent;
    }

    .logo-link img {
        display: block;
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: 2px;
        text-decoration: none;
        color: var(--text);
        background: none;
        border-radius: var(--border-s);
        white-space: nowrap;
        font-size: 14px;
    }

    .nav-link:hover {
        color: var(--rams-red);
        background: none;
    }

    .nav-link.active {
        color: var(--rams-black);
        background: none;
        font-weight: bold;
        text-decoration: underline;
    }

    .function-button {
        display: flex;
        align-items: center;
        padding: 2px;
        background: none;
        border: none;
        color: var(--text);
        border-radius: var(--border-s);
        cursor: pointer;
        white-space: nowrap;
        font-size: 14px;
    }

    .function-button:hover {
        color: var(--rams-red);
    }

    .function-button.disabled {
        opacity: 0.3;
        text-decoration: line-through;
    }

    .function-button.disabled:hover {
        color: var(--text);
    }

    @media (max-width: 1100px) {
        .function-button {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .bottom-nav {
            left: 50%;
            transform: translateX(-50%);
        }
    }
</style>
