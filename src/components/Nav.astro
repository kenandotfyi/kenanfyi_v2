---
const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
    if (href === "/") {
        return currentPath === "/";
    }
    return currentPath.startsWith(href);
};
---

<nav class="top-nav">
    <div class="nav-left">
        <a href="/" class="site-name"
            ><img src="/logo.svg" width="48" height="48" alt="kenan.fyi" />
        </a>
        <div class="nav-links">
            <a
                href="/thoughts/"
                class:list={["nav-link", { active: isActive("/thoughts/") }]}
            >
                Thoughts
            </a>
            <a
                href="/bits/"
                class:list={["nav-link", { active: isActive("/bits/") }]}
            >
                Bits
            </a>
            <a
                href="/library/"
                class:list={["nav-link", { active: isActive("/library/") }]}
            >
                Library
            </a>
            <a
                href="/bookmarks/"
                class:list={["nav-link", { active: isActive("/bookmarks/") }]}
            >
                Bookmarks
            </a>
            <a
                href="/blogroll/"
                class:list={["nav-link", { active: isActive("/blogroll/") }]}
            >
                Blogroll
            </a>
            <a
                href="/about/"
                class:list={["nav-link", { active: isActive("/about/") }]}
            >
                About
            </a>
        </div>
    </div>
    <div class="nav-right">
        <button
            id="panels-toggle"
            class="panels-toggle"
            aria-label="Toggle Panels"
        >
            Panels
        </button>
        <button id="hamburger" class="hamburger" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</nav>

<script>
    const PANELS_STORAGE_KEY = "panels-enabled";
    const panelsToggle = document.getElementById("panels-toggle");
    const hamburger = document.getElementById("hamburger");
    const navLinks = document.querySelector(".nav-links");

    function getPanelsEnabled() {
        const stored = localStorage.getItem(PANELS_STORAGE_KEY);
        return stored !== "false";
    }

    function updatePanelsToggle() {
        const isEnabled = getPanelsEnabled();
        if (panelsToggle) {
            panelsToggle.classList.toggle("disabled", !isEnabled);
        }
        window.dispatchEvent(
            new CustomEvent("panels-toggle", {
                detail: { enabled: isEnabled },
            }),
        );
    }

    panelsToggle?.addEventListener("click", (e) => {
        e.preventDefault();
        const currentState = getPanelsEnabled();
        localStorage.setItem(PANELS_STORAGE_KEY, (!currentState).toString());
        updatePanelsToggle();
    });

    hamburger?.addEventListener("click", () => {
        hamburger.classList.toggle("active");
        navLinks?.classList.toggle("active");
    });

    // Close menu when clicking a link
    document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", () => {
            hamburger?.classList.remove("active");
            navLinks?.classList.remove("active");
        });
    });

    updatePanelsToggle();
</script>

<style>
    .top-nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1500;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 24px;
        border-bottom: 1px solid var(--panel-border);
        background: transparent;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    .site-name {
        display: block;
        line-height: 0;
        text-decoration: none;
    }

    .site-name:hover {
        background: none;
    }

    .site-name img {
        display: block;
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-left {
        display: flex;
        align-items: center;
        gap: 8px;

        & span {
            font-family: monospace;
            font-size: 0.85rem;
        }
    }

    .nav-links {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .nav-link {
        padding: 4px 10px;
        text-decoration: none;
        font-size: 1rem;
        border-radius: var(--border-s);
        transition: color 0.2s ease;
    }

    .nav-link:hover {
        color: var(--accent);
    }

    .nav-link.active {
        color: var(--accent);
        font-weight: 600;
    }

    .panels-toggle {
        padding: 4px 10px;
        background: none;
        border: 1px solid var(--panel-border);
        color: var(--text);
        border-radius: var(--border-s);
        cursor: pointer;
        font-size: 0.85rem;
        font-family: inherit;
        transition: all 0.2s ease;
    }

    .panels-toggle:hover {
        border-color: var(--accent);
        color: var(--accent);
    }

    .panels-toggle.disabled {
        opacity: 0.4;
        text-decoration: line-through;
    }

    .hamburger {
        display: none;
        flex-direction: column;
        gap: 4px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        z-index: 1501;
    }

    .hamburger span {
        display: block;
        width: 24px;
        height: 2px;
        background: var(--text);
        transition: all 0.3s ease;
    }

    .hamburger.active span:nth-child(1) {
        transform: rotate(-45deg) translate(0px, 0px);
    }

    .hamburger.active span:nth-child(2) {
        transform: rotate(-45deg) translate(0px, 0px);
    }

    .hamburger.active span:nth-child(3) {
        transform: rotate(-45deg) translate(0px, 0px);
    }

    @media (max-width: 1100px) {
        .panels-toggle {
            display: none;
        }
    }

    @media (max-width: 768px) {
        .top-nav {
            padding: 8px;
            background: transparent;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(12px);
        }

        .hamburger {
            display: flex;
        }

        .nav-links {
            display: none;
            position: fixed;
            top: 64px;
            right: 16px;
            width: auto;
            min-width: fit-content;
            background: var(--bg);
            flex-direction: column;
            align-items: stretch;
            gap: 4px;
            padding: 4px 0;
            border: 1px solid var(--panel-border);
            border-radius: var(--border-s);
        }

        .nav-links.active {
            display: flex;
        }

        .nav-link {
            font-size: 1rem;
            padding: 2px 10px;
        }
    }
</style>
