---
import { Icon } from "astro-icon/components";
const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
    if (href === "/") {
        return currentPath === "/";
    }
    return currentPath.startsWith(href);
};
---

<nav class="top-nav">
    <ul class="nav-links">
        <li><a href="/" class="nav-link home">kenan.fyi</a></li>
        <li><Icon name="ph:dot-duotone" size="20" /></li>
        <li>
            <a
                href="/thoughts/"
                class:list={["nav-link", { active: isActive("/thoughts/") }]}
                >Thoughts</a
            >
        </li>
        <li>
            <a
                href="/bits/"
                class:list={["nav-link", { active: isActive("/bits/") }]}
                >Bits</a
            >
        </li>
        <li>
            <a
                href="/library/"
                class:list={["nav-link", { active: isActive("/library/") }]}
                >Library</a
            >
        </li>
        <li>
            <a
                href="/bookmarks/"
                class:list={["nav-link", { active: isActive("/bookmarks/") }]}
                >Bookmarks</a
            >
        </li>
        <li>
            <a
                href="/blogroll/"
                class:list={["nav-link", { active: isActive("/blogroll/") }]}
                >Blogroll</a
            >
        </li>
        <li>
            <a
                href="/about/"
                class:list={["nav-link", { active: isActive("/about/") }]}
                >About</a
            >
        </li>
    </ul>

    <div class="nav-right">
        <button
            id="theme-toggle"
            class="theme-toggle"
            aria-label="Toggle theme"
        >
            <span class="icon-sun"
                ><Icon name="ph:sun-duotone" size="18" /></span
            >
            <span class="icon-moon"
                ><Icon name="ph:moon-duotone" size="18" /></span
            >
        </button>
    </div>
</nav>

<script>
    const themeToggle = document.getElementById("theme-toggle");

    function getTheme() {
        return document.documentElement.getAttribute("data-theme") ?? "dark";
    }

    function setTheme(theme: string) {
        if (theme === "light") {
            document.documentElement.setAttribute("data-theme", "light");
        } else {
            document.documentElement.removeAttribute("data-theme");
        }
        localStorage.setItem("theme", theme);
    }

    themeToggle?.addEventListener("click", () => {
        setTheme(getTheme() === "light" ? "dark" : "light");
    });
</script>

<style>
    .top-nav {
        display: flex;
        gap: 4px;
        z-index: 30;
        margin-top: 1rem;
        margin-bottom: 1rem;
    }

    .site-name {
        display: inline-flex;
        text-decoration: none;
        flex-shrink: 0;
        font-size: 1rem;
        letter-spacing: -0.02em;
        margin-right: 0.5rem;
    }

    .site-name:hover span {
        opacity: 0.75;
    }

    .site-name img {
        display: block;
    }

    .nav-links {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 4px;
        flex: 1;
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .nav-links :global(svg) {
        display: block;
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-left: auto;
        flex-shrink: 0;
    }

    .nav-link {
        text-decoration: none;
        text-transform: lowercase;
        padding-right: 4px;
        transition: color 0.2s ease;
        white-space: nowrap;
    }

    .nav-link:hover {
        color: var(--red-dim);
        background: unset;
    }

    .nav-link.active {
        color: var(--red);
    }

    .home {
        font-weight: 700;
    }

    .theme-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4px 6px;
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        transition: color 0.2s ease;
        line-height: 0;
    }

    .theme-toggle:hover {
        color: var(--accent);
    }

    /* in dark mode: show sun (click to go light), hide moon */
    :global(html:not([data-theme="light"])) .icon-moon {
        display: none;
    }
    /* in light mode: show moon (click to go dark), hide sun */
    :global(html[data-theme="light"]) .icon-sun {
        display: none;
    }
</style>
